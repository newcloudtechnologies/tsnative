# Шаблонный проект TSNative

Шаблонный проект предоставляет собой каркас приложения, основанного на TSNative.

# Предварительные требования
cmake, npm, conan в системе

# Начало работы
Установите специфичные для TSNative conan-профили. В дальнейшем это поможет собирать проект под различные платформы.
```
npm run init_conan
```
В секции **config** корневого package.json указываются следующие параметры:
- TSNATIVE_VERSION - версия TSNative, которой будет производиться сборка проекта. Поддерживается только указание _конкретной_ версии, без диапазона версий
- BUILD_TYPE - тип сборки. Допустимые значения совпадают с допустимыми значениями [CMAKE_BUILD_TYPE](https://cmake.org/cmake/help/latest/variable/CMAKE_BUILD_TYPE.html)
- CONAN_PROFILE_BUILD - conan-профиль сборочной платформы
- CONAN_PROFILE_HOST - conan-профиль целевой платформы
- TSNATIVE_USE_CUSTOM_SEED - выбор использования точки входа в приложение (из поставки tsnative/пользовательская точка входа)

Список доступных conan-профилей выводится командой
```
npm run show_conan_profiles
```
В таблице представлены профили для поддерживаемых платформ:
| Platform           | CONAN_PROFILE_BUILD            | CONAN_PROFILE_HOST             |
| :----------------- | :----------------------------- | :----------------------------- |
| Android: arm64-v8a | linux_x86_64_gcc9              | android_armv8.jinja            |
| Android: x86_64    | linux_x86_64_gcc9              | android_x86_64.jinja           |
| Linux: x86_64      | linux_x86_64_gcc9              | linux_x86_64_gcc9              |
| Macos: arm64-v8    | darwin_armv8_apple-clang-12.0  | darwin_armv8_apple-clang-12.0  |
| Macos: x86_64      | darwin_x86_64_apple-clang-12.0 | darwin_x86_64_apple-clang-12.0 |
| Windows: x86_64    | windows_x86_64_mingw_gcc11     | windows_x86_64_mingw_gcc11     |

Сборка под Android подразумевает кросскомпиляцию в докере из под Linux.

# C++ код (расширения)
Поддержка C++ доступна в ветке ts+cxx данного репозитория.
C++ код, который может быть вызван на стороне TypeScript _желательно_ располагать в директории cxx.
Экспортируемые классы и функции должны быть помечены соответствующими макросами из TS.h.
В CMakeLists.txt необходимо:
- Использовать функцию **ts_generate_declarations** для получения *.d.ts файлов деклараций, которые будут импортироваться в коде приложения
- Расширение должно быть добавлено в список расширений с помощью макроса **add_extension**
- Сгенерированные декларации должны быть скопированы с помощью макроса **copy_to_node_modules**

Пример использования внешней зависимости, поставляемой через conan находится в ветке dev/mgt_dependency_example

# Сборка
Сборка проекта выполняется командой
```
npm run build
```
Собранный артефакт можно найти по пути <project_root>/out/<cmake_project_name>

Очистка проекта производится командой
```
npm run clean
```
Пересборка проекта производится командой
```
npm run rebuild
```
